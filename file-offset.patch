--- file-4.18.org/src/funcs.c	2006-10-31 20:37:17.000000000 +0100
+++ file/src/funcs.c	2006-11-25 00:52:17.259907000 +0100
@@ -151,10 +151,16 @@
 protected int
 file_reset(struct magic_set *ms)
 {
+	struct mlist *ml;
 	if (ms->mlist == NULL) {
 		file_error(ms, 0, "no magic files loaded");
 		return -1;
 	}
+	for (ml = ms->mlist->next; ml != ms->mlist; ml = ml->next) {
+		uint32_t magindex;
+		for (magindex = 0; magindex < ml->nmagic; magindex++)
+			ml->magic[magindex].offset = 0;
+	}
 	ms->o.ptr = ms->o.buf;
 	ms->haderr = 0;
 	ms->error = -1;
