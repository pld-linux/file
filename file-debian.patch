#!/bin/sh /usr/share/dpatch/dpatch-run
## 318-magic-add-par2.dpatch by Daniel van Eeden <daniel_e@dds.nl>
##
## DP: New magic for PAR2 archive files (Closes: #294070).

@DPATCH@

diff -Naurp file-4.24.orig/magic/Magdir/archive file-4.24/magic/Magdir/archive
--- file-4.24.orig/magic/Magdir/archive	2008-02-28 18:57:34.000000000 +0000
+++ file-4.24/magic/Magdir/archive	2008-04-07 08:05:47.000000000 +0000
@@ -803,3 +803,6 @@
 >24	belong	1		SHA-1 checksum
 >24	belong	2		MD5 checksum
 
+# Type: Parity Archive
+# From: Daniel van Eeden <daniel_e@dds.nl>
+0	string	 PAR2		Parity Archive Volume Set
#!/bin/sh /usr/share/dpatch/dpatch-run
## 319-magic-add-pe5.dpatch by Simon Horman <horms@debian.org>
##
## DP: New magic for the Ulead Photo Explorer5 image format (Closes: #339397).

@DPATCH@

diff -Naurp file-4.24.orig/magic/Magdir/images file-4.24/magic/Magdir/images
--- file-4.24.orig/magic/Magdir/images	2008-03-07 14:58:54.000000000 +0000
+++ file-4.24/magic/Magdir/images	2008-04-07 08:07:42.000000000 +0000
@@ -588,3 +588,8 @@
 0	string	\xed\xfe\xda\xbe	Cytovision FLEX file
 0	string	\xed\xab\xed\xfe	Cytovision FLEX file
 0	string	\xad\xfd\xea\xad	Cytovision RATS file
+
+# Type: Ulead Photo Explorer5 (.pe5)
+# URL:  http://www.jisyo.com/cgibin/view.cgi?EXT=pe5 (Japanese)
+# From: Simon Horman <horms@debian.org>
+0	string	IIO2H	Ulead Photo Explorer5
#!/bin/sh /usr/share/dpatch/dpatch-run
## 320-magic-add-pmenu.dpatch by Edward Betts <edward@debian.org>
##
## DP: New magic for pmenu (Closes: #38543).

@DPATCH@

diff -Naurp file-4.23.orig/magic/Magdir/commands file-4.23/magic/Magdir/commands
--- file-4.23.orig/magic/Magdir/commands	2007-06-01 19:40:26.000000000 +0000
+++ file-4.23/magic/Magdir/commands	2008-01-12 17:34:41.000000000 +0000
@@ -55,3 +55,8 @@
 0	string		Zend\x00		PHP script Zend Optimizer data
 
 0	string		$!			DCL command file
+
+# Type: Pdmenu
+# URL:  http://packages.debian.org/pdmenu
+# From: Edward Betts <edward@debian.org>
+0	string	#!/usr/bin/pdmenu	Pdmenu configuration file text
#!/bin/sh /usr/share/dpatch/dpatch-run
## 321-magic-add-powertab.dpatch by Jelmer Vernooij <jelmer@samba.org>
##
## DP: New magic for Power-Tab

@DPATCH@

diff -Naur file-4.20.orig/magic/Magdir/chord file-4.20/magic/Magdir/chord
--- file-4.20.orig/magic/Magdir/chord	2003-03-24 14:48:32.000000000 +0000
+++ file-4.20/magic/Magdir/chord	2007-05-17 16:33:26.000000000 +0000
@@ -7,3 +7,8 @@
 #
 0	string		{title		Chord text file
 
+# Type:	PowerTab file format
+# URL:	http://www.power-tab.net/
+# From:	Jelmer Vernooij <jelmer@samba.org>
+0	string		ptab\003\000	Power-Tab v3 Tablature File
+0	string		ptab\004\000	Power-Tab v4 Tablature File
#!/bin/sh /usr/share/dpatch/dpatch-run
## 322-magic-add-scummvm.dpatch by Sven Hartge <debian@ds9.argh.org>
##
## DP: New magic for scummVM savegame files (Closes: #263488).

@DPATCH@

diff -Naurp file-4.23.orig/magic/Magdir/console file-4.23/magic/Magdir/console
--- file-4.23.orig/magic/Magdir/console	2007-09-26 20:22:31.000000000 +0000
+++ file-4.23/magic/Magdir/console	2008-01-12 17:36:55.000000000 +0000
@@ -252,3 +252,7 @@
 # .w3m
 0	string HM3W				Warcraft III map file
 
+# Type: scummVM savegame files
+# From: Sven Hartge <debian@ds9.argh.org>
+0	string	SCVM	scummVM savegame
+>12	string	>\0	"%s"
#!/bin/sh /usr/share/dpatch/dpatch-run
## 323-magic-add-sgf.dpatch by Eduardo Sabbatella <eduardo_sabbatella@yahoo.com.ar>
##
## DP: New magic for SGF Smart Game Format

@DPATCH@

diff -Naurp file-4.24.orig/magic/Magdir/games file-4.24/magic/Magdir/games
--- file-4.24.orig/magic/Magdir/games	2008-02-19 17:27:30.000000000 +0000
+++ file-4.24/magic/Magdir/games	2008-04-07 08:09:12.000000000 +0000
@@ -151,3 +151,16 @@
 >4	lelong	x		containing %d lumps
 0	string	=PWAD		doom patch PWAD data
 >4	lelong	x		containing %d lumps
+
+# Type: SGF Smart Game Format
+# URL:  http://www.red-bean.com/sgf/
+# From: Eduardo Sabbatella <eduardo_sabbatella@yahoo.com.ar>
+
+2	regex/c	\\(;.*GM\\[[0-9]{1,2}\\]	Smart Game Format
+>2	regex/c	GM\\[1\\]			- Go Game
+>2	regex/c	GM\\[6\\]			- BackGammon Game
+>2	regex/c	GM\\[11\\]			- Hex Game
+>2	regex/c	GM\\[18\\]			- Amazons Game
+>2	regex/c	GM\\[19\\]			- Octi Game
+>2	regex/c	GM\\[20\\]			- Gess Game
+>2	regex/c	GM\\[21\\]			- twix Game
#!/bin/sh /usr/share/dpatch/dpatch-run
## 323-magic-add-sisu.dpatch by Ralph Amissah <ralph.amissah@gmail.com>
##
## DP: New magic for SiSU Markup Language.

@DPATCH@

diff -Naurp file-4.24.orig/magic/Magdir/sisu file-4.24/magic/Magdir/sisu
--- file-4.24.orig/magic/Magdir/sisu	1970-01-01 00:00:00.000000000 +0000
+++ file-4.24/magic/Magdir/sisu	2008-04-07 08:10:25.000000000 +0000
@@ -0,0 +1,18 @@
+# Type: SiSU Markup Language
+# URL:  http://www.sisudoc.org/
+# From: Ralph Amissah <ralph.amissah@gmail.com>
+
+0	regex	\^%?[\ \t]*SiSU[\ \t]+insert	SiSU text insert
+>5	regex	[0-9.]+				%s
+
+0	regex	\^%[\ \t]+SiSU[\ \t]+master	SiSU text master
+>5	regex	[0-9.]+				%s
+
+0	regex	\^%?[\ \t]*SiSU[\ \t]+text	SiSU text
+>5	regex	[0-9.]+				%s
+
+0	regex	\^%?[\ \t]*SiSU[\ \t][0-9.]+	SiSU text
+>5	regex	[0-9.]+				%s
+
+0	regex	\^%*[\ \t]*sisu-[0-9.]+		SiSU text
+>5	regex	[0-9.]+				%s
diff -Naurp file-4.24.orig/magic/Makefile.am file-4.24/magic/Makefile.am
--- file-4.24.orig/magic/Makefile.am	2008-03-22 21:41:00.000000000 +0000
+++ file-4.24/magic/Makefile.am	2008-04-07 08:11:04.000000000 +0000
@@ -170,6 +170,7 @@ $(MAGIC_FRAGMENT_DIR)/sgi \
 $(MAGIC_FRAGMENT_DIR)/sgml \
 $(MAGIC_FRAGMENT_DIR)/sharc \
 $(MAGIC_FRAGMENT_DIR)/sinclair \
+$(MAGIC_FRAGMENT_DIR)/sisu \
 $(MAGIC_FRAGMENT_DIR)/sketch \
 $(MAGIC_FRAGMENT_DIR)/smalltalk \
 $(MAGIC_FRAGMENT_DIR)/sniffer \
diff -Naurp file-4.24.orig/magic/Makefile.in file-4.24/magic/Makefile.in
--- file-4.24.orig/magic/Makefile.in	2008-03-22 21:41:06.000000000 +0000
+++ file-4.24/magic/Makefile.in	2008-04-07 08:11:10.000000000 +0000
@@ -330,6 +330,7 @@ $(MAGIC_FRAGMENT_DIR)/sgi \
 $(MAGIC_FRAGMENT_DIR)/sgml \
 $(MAGIC_FRAGMENT_DIR)/sharc \
 $(MAGIC_FRAGMENT_DIR)/sinclair \
+$(MAGIC_FRAGMENT_DIR)/sisu \
 $(MAGIC_FRAGMENT_DIR)/sketch \
 $(MAGIC_FRAGMENT_DIR)/smalltalk \
 $(MAGIC_FRAGMENT_DIR)/sniffer \
#!/bin/sh /usr/share/dpatch/dpatch-run
## 324-magic-add-snes.dpatch by Josh Triplett <josh@freedesktop.org>
##
## DP: New magic for SNES SPC700 sound files (Closes: #410847).

@DPATCH@

diff -Naur file-4.21.orig/magic/Magdir/audio file-4.21/magic/Magdir/audio
--- file-4.21.orig/magic/Magdir/audio	2007-12-23 17:32:42.000000000 +0000
+++ file-4.21/magic/Magdir/audio	2007-12-23 17:33:57.000000000 +0000
@@ -268,6 +268,15 @@
 >122	byte&0x1	=1		PAL
 >122	byte&0x1	=0		NTSC
 
+# Type: SNES SPC700 sound files
+# From: Josh Triplett <josh@freedesktop.org>
+0	string	SNES-SPC700\ Sound\ File\ Data\ v	SNES SPC700 sound file
+>&0	string	0.30					\b, version %s
+>>0x23	byte	0x1B					\b, without ID666 tag
+>>0x23	byte	0x1A					\b, with ID666 tag
+>>>0x2E	string	>\0					\b, song "%.32s"
+>>>0x4E	string	>\0					\b, game "%.32s"
+
 # Impulse tracker module (audio/x-it)
 0	string		IMPM		Impulse Tracker module sound data -
 >4	string		>\0		"%s"
#!/bin/sh /usr/share/dpatch/dpatch-run
## 325-magic-add-ssl.dpatch by Nicolas Collignon <tsointsoin@gmail.com>
##
## DP: New magic for OpenSSH key files (Closes: #439537).

@DPATCH@

diff -Naur file-4.21.orig/magic/Magdir/ssh file-4.21/magic/Magdir/ssh
--- file-4.21.orig/magic/Magdir/ssh	1970-01-01 00:00:00.000000000 +0000
+++ file-4.21/magic/Magdir/ssh	2007-08-26 08:25:03.000000000 +0000
@@ -0,0 +1,8 @@
+# Type: OpenSSH key files
+# From: Nicolas Collignon <tsointsoin@gmail.com>
+
+0	string	SSH\ PRIVATE\ KEY	OpenSSH RSA1 private key,
+>28	string	>\0			version %s
+
+0	string	ssh-dss\		OpenSSH DSA public key
+0	string	ssh-rsa\		OpenSSH RSA public key
#!/bin/sh /usr/share/dpatch/dpatch-run
## 325-magic-add-ssl.dpatch by Nicolas Collignon <tsointsoin@gmail.com>
##
## DP: New magic for OpenSSL certificates/key files (Closes: #439537).

@DPATCH@

diff -Naur file-4.21.orig/magic/Magdir/ssl file-4.21/magic/Magdir/ssl
--- file-4.21.orig/magic/Magdir/ssl	1970-01-01 00:00:00.000000000 +0000
+++ file-4.21/magic/Magdir/ssl	2007-08-26 08:27:04.000000000 +0000
@@ -0,0 +1,7 @@
+# Type: OpenSSL certificates/key files
+# From: Nicolas Collignon <tsointsoin@gmail.com>
+
+0	string	-----BEGIN\ CERTIFICATE-----	PEM certificate
+0	string	-----BEGIN\ CERTIFICATE\ REQ	PEM certificate request
+0	string	-----BEGIN\ RSA\ PRIVATE	PEM RSA private key
+0	string	-----BEGIN\ DSA\ PRIVATE	PEM DSA private key
#!/bin/sh /usr/share/dpatch/dpatch-run
## 325-magic-add-subversion.dpatch by Michael Piefel <piefel@debian.org>
##
## DP: New magic for SVN dumps (closes: #256652).

@DPATCH@

diff -Naur file-4.21.orig/magic/Magdir/revision file-4.21/magic/Magdir/revision
--- file-4.21.orig/magic/Magdir/revision	2007-12-23 17:25:39.000000000 +0000
+++ file-4.21/magic/Magdir/revision	2007-12-23 17:26:34.000000000 +0000
@@ -17,3 +17,8 @@
 0	string	HG10		Mercurial bundle,
 >4	string	UN		uncompressed
 >4	string	BZ		bzip2 compressed
+
+# Type:	Subversion (SVN) dumps
+# From:	Uwe Zeisberger <zeisberg@informatik.uni-freiburg.de>
+0	string	SVN-fs-dump-format-version:	Subversion dumpfile
+>28	string	>\0				(version: %s)
#!/bin/sh /usr/share/dpatch/dpatch-run
## 326-magic-add-supercollider.dpatch by Mario Lang <mlang@debian.org>
##
## DP: Adds new magic for SuperCollider 3 Synth Definition File Format
## DP: (Closes: #284803).

@DPATCH@

diff -Naurp file-4.23.orig/magic/Magdir/audio file-4.23/magic/Magdir/audio
--- file-4.23.orig/magic/Magdir/audio	2008-01-12 17:39:01.000000000 +0000
+++ file-4.23/magic/Magdir/audio	2008-01-12 17:38:49.000000000 +0000
@@ -576,3 +576,8 @@
 # URL:  http://filext.com/detaillist.php?extdetail=AMR
 # From: Russell Coker <russell@coker.com.au>
 0	string	#!AMR		Adaptive Multi-Rate Codec (GSM telephony)
+
+# Type: SuperCollider 3 Synth Definition File Format
+# From: Mario Lang <mlang@debian.org>
+0	string	SCgf	SuperCollider3 Synth Definition file,
+>4	belong	x	version %d
#!/bin/sh /usr/share/dpatch/dpatch-run
## 328-magic-add-xen.dpatch by Radek Vokal <rvokal@redhat.com>
##
## DP: xen patch, recognizes Xen saved domain

@DPATCH@

diff -Naurp file-4.23.orig/magic/Magdir/linux file-4.23/magic/Magdir/linux
--- file-4.23.orig/magic/Magdir/linux	2008-01-12 17:47:04.000000000 +0000
+++ file-4.23/magic/Magdir/linux	2008-01-12 17:46:42.000000000 +0000
@@ -248,3 +248,9 @@
 >72	string	x		%s]
 >168	string	x		UUID: %s
 
+# Type: Xen, the virtual machine monitor
+# From: Radek Vokal <rvokal@redhat.com>
+0	string		LinuxGuestRecord	Xen saved domain
+#>2	regex		\(name\ [^)]*\)		%s
+>20	search/256	(name			(name
+>>&1	string		x			%s...)
#!/bin/sh /usr/share/dpatch/dpatch-run
## 331-magic-add-xcursor.dpatch by Mathias Brodala <info@noctus.net>
##
## DP: New magic for X11 cursor files (Closes: #451246).

@DPATCH@

diff -Naur file-4.21.orig/magic/Magdir/images file-4.21/magic/Magdir/images
--- file-4.21.orig/magic/Magdir/images	2007-12-23 17:40:53.000000000 +0000
+++ file-4.21/magic/Magdir/images	2007-12-23 17:40:46.000000000 +0000
@@ -534,3 +534,8 @@
 # URL:  http://www.jisyo.com/cgibin/view.cgi?EXT=pe5 (Japanese)
 # From: Simon Horman <horms@debian.org>
 0	string	IIO2H	Ulead Photo Explorer5
+
+# Type:	X11 cursor
+# URL:	http://webcvs.freedesktop.org/mime/shared-mime-info/freedesktop.org.xml.in?view=markup
+# From:	Mathias Brodala <info@noctus.net>
+0	string	Xcur	X11 cursor
#!/bin/sh /usr/share/dpatch/dpatch-run
## 903-magic-local.dpatch by Michael Piefel <piefel@debian.org>
##
## DP: No longer includes Localstuff in /usr/share/misc/magic. Local definitions
## DP: should go to /etc/magic.

@DPATCH@

diff -Naurp file-4.24.orig/magic/Header file-4.24/magic/Header
--- file-4.24.orig/magic/Header	2000-08-05 17:36:46.000000000 +0000
+++ file-4.24/magic/Header	2008-04-07 08:17:11.000000000 +0000
@@ -1,5 +1,5 @@
-# Magic
 # Magic data for file(1) command.
-# Machine-generated from src/cmd/file/magdir/*; edit there only!
-# Format is described in magic(files), where:
-# files is 5 on V7 and BSD, 4 on SV, and ?? in the SVID.
+# Format is described in magic(5).
+# Don't edit this file, edit /etc/magic or send your suggested inclusions to
+# this file as a wishlist bug against file (using the reportbug utility).
+
diff -Naurp file-4.24.orig/magic/magic.local file-4.24/magic/magic.local
--- file-4.24.orig/magic/magic.local	1970-01-01 00:00:00.000000000 +0000
+++ file-4.24/magic/magic.local	2008-04-07 08:17:11.000000000 +0000
@@ -0,0 +1,3 @@
+# Magic local data for file(1) command.
+# Insert here your local magic data. Format is described in magic(5).
+
diff -Naurp file-4.24.orig/src/Makefile.am file-4.24/src/Makefile.am
--- file-4.24.orig/src/Makefile.am	2008-02-24 01:33:05.000000000 +0000
+++ file-4.24/src/Makefile.am	2008-04-07 08:16:39.000000000 +0000
@@ -5,7 +5,7 @@ EXTRA_DIST = getopt_long.c
 
 bin_PROGRAMS = file
 
-AM_CPPFLAGS = -DMAGIC='"$(MAGIC)"'
+AM_CPPFLAGS = -DMAGIC='"/etc/magic:$(MAGIC)"'
 
 libmagic_la_SOURCES = magic.c apprentice.c softmagic.c ascmagic.c \
 	compress.c is_tar.c readelf.c print.c fsmagic.c \
diff -Naurp file-4.24.orig/src/Makefile.in file-4.24/src/Makefile.in
--- file-4.24.orig/src/Makefile.in	2008-03-22 21:40:13.000000000 +0000
+++ file-4.24/src/Makefile.in	2008-04-07 08:16:47.000000000 +0000
@@ -198,7 +198,7 @@ MAGIC = $(pkgdatadir)/magic
 lib_LTLIBRARIES = libmagic.la
 include_HEADERS = magic.h
 EXTRA_DIST = getopt_long.c
-AM_CPPFLAGS = -DMAGIC='"$(MAGIC)"'
+AM_CPPFLAGS = -DMAGIC='"/etc/magic:$(MAGIC)"'
 libmagic_la_SOURCES = magic.c apprentice.c softmagic.c ascmagic.c \
 	compress.c is_tar.c readelf.c print.c fsmagic.c \
 	funcs.c file.h names.h patchlevel.h readelf.h tar.h apptype.c \
#!/bin/sh /usr/share/dpatch/dpatch-run
## 904-file-make.dpatch by Michael Piefel <piefel@debian.org>
##
## DP: FIXME

@DPATCH@

diff -Naurp file-4.23.orig/src/Makefile.in file-4.23/src/Makefile.in
--- file-4.23.orig/src/Makefile.in	2008-01-12 17:55:24.000000000 +0000
+++ file-4.23/src/Makefile.in	2008-01-12 17:56:46.000000000 +0000
@@ -300,7 +300,7 @@ clean-binPROGRAMS:
 	done
 file$(EXEEXT): $(file_OBJECTS) $(file_DEPENDENCIES) 
 	@rm -f file$(EXEEXT)
-	$(LINK) $(file_OBJECTS) $(file_LDADD) $(LIBS)
+	$(LINK) $(file_OBJECTS) $(file_LDADD)
 
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
#!/bin/sh /usr/share/dpatch/dpatch-run
## 906-file-hurd.dpatch by Michael Casadevall <sonicmctails@gmail.com>
##
## DP: Fixes a FTBFS on hurd (Closes: #433716).

@DPATCH@

diff -Naur file-4.21.orig/src/magic.c file-4.21/src/magic.c
--- file-4.21.orig/src/magic.c	2007-03-26 17:59:50.000000000 +0000
+++ file-4.21/src/magic.c	2007-07-19 06:25:16.000000000 +0000
@@ -58,6 +58,11 @@
 #include <locale.h>
 #endif
 
+#ifndef PIPE_BUF
+// Get the PIPE_BUF from pathconf
+#define PIPE_BUF pathconf(".", _PC_PIPE_BUF)
+#endif
+
 #include <netinet/in.h>		/* for byte swapping */
 
 #include "patchlevel.h"
#!/bin/sh /usr/share/dpatch/dpatch-run
## 998-doc-manpages.dpatch by Michael Piefel <piefel@debian.org>
##
## DP: FIXME, and #417511.

@DPATCH@

diff -Naurp file-4.24.orig/doc/file.man file-4.24/doc/file.man
--- file-4.24.orig/doc/file.man	2008-03-07 15:00:07.000000000 +0000
+++ file-4.24/doc/file.man	2008-04-07 08:26:06.000000000 +0000
@@ -51,7 +51,7 @@ meaning anything else (data is usually 
 or non-printable).
 Exceptions are well-known file formats (core files, tar archives)
 that are known to contain binary data.
-When modifying magic files or the program itself, make sure to
+When adding local definitions to /etc/magic, make sure to
 .Em "preserve these keywords" .
 Users depend on knowing that all the readable files in a directory
 have the word 
@@ -95,7 +95,8 @@ The concept of a
 has been applied by extension to data files.
 Any file with some invariant identifier at a small fixed
 offset into the file can usually be described in this way.
-The information identifying these files is read from the compiled
+The information identifying these files is read from /etc/magic
+and the the compiled
 magic file
 .Pa __MAGIC__.mgc ,
 or the files in the directory
@@ -326,6 +327,11 @@ will not attempt to open
 adds
 .Dq .mgc
 to the value of this variable as appropriate.
+However,
+.Pa file
+has to exist in order for
+.Pa file.mime
+to be considered.
 The environment variable
 .Dv POSIXLY_CORRECT
 controls (on systems that support symbolic links), whether
@@ -401,12 +407,6 @@ will be distributed periodically.
 The order of entries in the magic file is significant.
 Depending on what system you are using, the order that
 they are put together may be incorrect.
-If your old
-.Nm
-command uses a magic file,
-keep the old magic file around for comparison purposes
-(rename it to 
-.Pa __MAGIC__.orig ).
 .Sh EXAMPLES
 .Bd -literal -offset indent 
 $ file file.c file /dev/{wd0a,hda}
@@ -548,3 +548,8 @@ on
 .Dv ftp.astron.com
 in the directory
 .Dv /pub/file/file-X.YZ.tar.gz
+.Pp
+This Debian version adds a number of new magix entries. It can be
+obtained from every site carrying a Debian distribution (that is
+.Dv ftp.debian.org
+and mirrors).
#!/bin/sh /usr/share/dpatch/dpatch-run
## 999-conglomeration.dpatch by Michael Piefel <piefel@debian.org>
##
## DP: Needs to be broken out (FIXME).

@DPATCH@

diff -Naurp file-4.24.orig/src/fsmagic.c file-4.24/src/fsmagic.c
--- file-4.24.orig/src/fsmagic.c	2008-02-14 20:14:52.000000000 +0000
+++ file-4.24/src/fsmagic.c	2008-04-07 08:32:13.000000000 +0000
@@ -110,7 +110,8 @@ file_fsmagic(struct magic_set *ms, const
 		if (file_printf(ms, "cannot open `%s' (%s)",
 		    fn, strerror(errno)) == -1)
 			return -1;
-		return 1;
+		ms->haderr++;
+		return -1;
 	}
 
 	if (mime) {
